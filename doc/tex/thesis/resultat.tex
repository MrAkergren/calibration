\section{Resultat} % (fold)
\label{sec:resultat}
    \subsection{Algoritm} % (fold)
    \label{sub:algoritm}
        För att möjliggöra automatisk kalibrering av panelens ljussensor har projektet utvecklat en sökalgoritm med positionsregistrering och stegreducering. Den utvecklade algoritmen gav svar på den första av projektets tre frågeställningar, ''Vilken algoritm kan anses vara lämplig för kalibreringen?''. Algoritmen uppsöker ett lokalt maximum i ljusstyrka, beskrivet i avsnitt~\ref{ssub:utveckling_av_algoritm}, och fanns lämplig för ändamålet.\bigskip

        Algoritmen söker kontinuerligt stegvis efter det maximala inlästa värdet tills inga kringliggande större värden påträffas och justerar i varje söksteg panelens korrigeringsvärde för ljussensorn, vilket får panelen att vrida sig till den position som ger solljusets fokus i ljussensors korrigerade mittpunkt. Sökning sker i fyra riktningar, representerade av väderstrecksuttryck motsvarande den koordinatsystemsrepresentation panelen har för korrigeringsvärden där positiva x och y är öst respektive nord, och sker medurs med utgångsriktning österut. Om ett lika stort eller större värde avläses efter en vridning av panelen så kommer nästkommande undersökta position vara i samma riktning som den senast utförda, då avlästa värden kan representeras enligt figur~\ref{fig:array}. Algoritmen registrerar besökta positioner så att samma position ej undersöks upprepade gånger. Flödesschema för algoritmen finnes i bilaga \ref{sec:sokalgoritm_flow}. \bigskip

        Tillgången till kontinuerligt solljus är en förutsättning för kalibrering av enheter tagna i bruk då variationer i molnighet markant påverkar ljusintensiteten och således det avlästa värdet. I händelse av längre tids molnighet deaktiveras ljussensorn av panelens mjukvara och kalibrering går då ej att genomföra. Om så sker under pågående kalibrering återställs panelens korrigeringsvärden till de värden som var aktuella innan den automatiska kalibreringen startade. För att ytterligare motverka oförutsedda problem vid kalibreringstillfället har kontroller för timeout och korrigeringsvärdenas rimlighet implementerats, där båda kontrollerna vid utslag avbryter sökningen och korrigeringsvärdena återställs.

    % subsection algoritm (end)
    \subsection{Optisk kommunikation} % (fold)
    \label{sub:optisk_kommunikation}
        För att svara upp mot målet att ta fram en lösning för ''kommunikation mellan en luxmätare inne i byggnaden och en panel som befinner sig på taket'' besvaras i efterföljande frågeställningar för förutsättningar för kommunikation och hur tillförlitliga dessa lösningar kan anses vara.

        \subsubsection{Förutsättningar} % (fold)
        \label{sub:forutsattningar}
                
            Frågeställningen ''[v]ilka förutsättningar för kommunikation finns det mellan solpanelen och det upplysta rummet'' har resulterat i en undersökning som visade att trådlös kommunikation inte är att anses som lämplig, utan nyttjande av den redan dragna optiska fiberkabeln är det kommunikationsmedia som bör nyttjas. Projektet föreslår två olika metoder för att nyttja fibern som databärare, dels en metod där asynkron seriell data skickas och en annan metod där två optiska fibrer kopplas samman, för att på sådant sätt skicka ut ljusintaget genom panelens linser och där mäta upp ljusstyrkan.\bigskip

            Den första lösningen som projektet föreslog var en en lösning där en mikrokontroller inne i det upplysta rummet omvandlar utdata från en luxmätare till en optisk signal som sedan sänds seriellt, enligt standarden RS-232, upp till panelen för att där avkodas av en andra mottagande mikrokontroller. När signalerna skickas via fibrerna strålas ljuset ut ur solpanelens linser, vilket mottagaren då kan analysera. Mottagaren är monterad på panelen och har en ljuskänslig sensor som omvandlar de optiska signalerna till digitala. De digitala signalerna skickas från mottagaren vidare till den enhet som utför den algoritm som är avsedd att kalibrera ljussensorn. \bigskip

            Den andra lösningen var att, istället för att mäta upp ljusstyrkan i rummet, koppla ihop två stycken optiska fibrer från samma panel i det rum de är avsedda att upplysa, vilket då skickar ljusintaget tillbaka upp till panelen. Genom att täcka över de linser som förser den ena fiberkabeln med ljus kommer den andra fiberkabeln att skicka ut sitt ljusintag mot de nu täckta linserna. I detta förslag kan en luxmätare placeras i övertäckningsanordningen och där, via omvägen till det upplysta rummet och tillbaka, mäta upp hur mycket ljus panelen tar emot. Då luxmätaren nu befinner sig på panelen kan den direkt skicka sin data till den enhet som förväntas utföra algoritmen.

        % subsection förutsättningar (end)

        \subsubsection{Tillförlitlighet} % (fold)
        \label{sub:tillf_rlitlighet}
            För att komma fram till ett svar på frågan ''[h]ur tillförlitligt är det valda kommunikationssättet?'' utreddes flera alternativ för att sända data. Genom att använda de fördragna fiberoptiska kablarna säkerställs att det ljus som skickas från rummet upp till panelen alltid kommer att levereras, förutsatt att ljuskällan är tillräckligt stark. Detta är i skarp kontrast mot en trådlös lösning, där flera lager betong mellan rummet och panelen inte är en osannolik företeelse vilket då skulle resultera att datan aldrig når till panelen under normala förutsättningar. \bigskip

            Huruvida de två föreslagna lösningarna för ljussändning är tillförlitliga är beroende på hur ljuset läses av uppe vid panelen. I förslaget med två mikrokontroller, där data sänds seriellt via RS-232, är tillförlitligheten lägre, då den lösningen är störningskänslig mot bakgrundsljus så en tillförlitlig fästningsanordning för panelen behöver tillverkas. Vid försök i labbmiljö har data kunnat sändas med hjälp en vanlig lysdiod driven av 5 volt, 20 mA via en fiberkabel om 16 meter och där tolkats från en enskild fiber. Varje fiberkabel består av sex stycken fibrer och varje fiber är kopplade till en egen lins för att fokuserar fokusera in soljuset. Nu när data skickas ''bakvägen'' kommer linsen att agera omvänt genom att omvandla fiberns fokuserade ljus till parallella strålar. Då ljuset nu är parallellt istället för fokuserat finns det risk att ljusintensiteten mellan hög och låg inte är tillräckligt stor för att fotosensorn ska registrera skillnaden, eller ändra sitt motstånd tillräckligt mycket. För att fotoresistorn ska ha möjlighet att registrera ljusändringarna hade det ideala varit en fokuseringslins till fotoresistorn och att resistorn hade varit innesluten i någon form av behållare att fästa över de sex linserna. \bigskip

            Det andra förslaget, där två fiberkablar kopplas samman för att skapa rundgång, är tillförlitligheten högre eftersom ingen behandlad data skickas. Ingen kommunikation behöver läsas av utan endast rådata i form av ljusstyrka skickas ut genom linserna. När ljusstyrkan då ska mätas är luxmätaren inte beroende av snabba ändringar i ljuset, utan ljuset är konstant vilket leder till en högre tillförlitlighet. Ljusstyrkan kommer vara lägre när den kommer upp till panelen, jämfört med om den skulle stråla ut i rummet, då den behöver färdas dubbelt så långt i fiberkabeln, men mätningen av ljusstyrkan är inte beroende av ett korrekt absolut värde. När panelen kalibreras är det istället av intresse att finna det högsta relativa värdet, det värde när panelen tar in mest ljus, för det är ljust där som panelen ska vara inställd på, oavsett vilket värde som projektets luxmätaren nu rapporterar. Detta medför också att denna metod är mindre känslig för bakgrundsljus, så länge bakgrundsljuset är konstant eftersom skillnaden i det utstrålade ljuset ändå kan registreras.\bigskip 

            För att kontrollera vilket faktiskt luxvärde som panelen levererar till rummet behöver mer kvalificerad materiel användas, materiel som är kalibrerad och granskad för att mäta upp luxvärden i rum. Det är apparatur som företaget har tillgängligt, men som ligger utanför detta projekt.
        % subsection tillf_rlitlighet (end)
    % subsection optisk_kommunikation (end)

    \subsection{Applikation} % (fold)
    \label{sub:applikation}
        Den framtagna applikationen gav en förutsättning att uppfylla målet ''att ta fram ett automatiskt system som justerar fokuspunkten på ljussensorn''. En automatisk kalibrering av panelens korrigeringsvärde för ljussensorn kan utföras genom att applikationen har kopplat samman sökalgoritmen med solpanelen och en luxmätare.\bigskip

        Sökalgoritmen implementerades i form av en Pythonapplikation med grafiskt gränssnitt och applikationen stödjer inhämtning av ljusvärden från antingen en till samma dator direkt ansluten luxmätare eller seriell mottagning från en annan enhet. Den luxmätare som användes vid implementationen av direkt anslutning var Yocto-Light-V3 medan Adafruit TSL2591 användes för avläsning som sedan överfördes seriellt via en Arduino Uno. Luxmätarna är beskrivna i avsnitt \ref{sub:yocto} respektive \ref{ssub:ada_tsl2591}. För seriell kommunikation använder applikationen sig av pySerial, ett bibliotek som kan hantera seriell kommunikation på de flesta vanligt förekommande operativsystem \cite{pyserial}. \bigskip

        Hos Parans fanns sedan tidigare kringutrustning som använder en Pythonapplikation med grafiskt gränssnitt anpassat till en pekskärm på en Raspberry Pi, där det grafiska gränssnittet är implementerat med ramverket TkInter \cite{solarremote}. Samma ramverk och grafiska formgivning har använts till den applikation som utvecklats av projektet. Detta upplägg är tänkt att underlätta framtida hantering och utveckling av applikationerna och möjliggör en eventuell framtida integrering av de båda. \bigskip

        Applikationen är utvecklad enligt en objektorienterad utvecklingsmodell och nya avläsningsmetoder kan implementeras utan större ingrepp i befintlig kod. För en översikt av källkodens struktur se UML diagrammen i bilaga~\ref{sec:uml_diagram}. Mjukvaran till Parans kommande solpanel, SP4, var ej färdigställd under projektets gång och således är applikationen riktad till SP3. Implementeringen av sökalgoritmen kan återanvändas till kommande versioner av solpaneler men vissa anpassningar kan behövas.
    % subsection applikation % (end)
% section resultat (end)
